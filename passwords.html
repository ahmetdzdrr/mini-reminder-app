<!DOCTYPE html>
<html>
	<head>
		<title>Şifre Yöneticisi</title>
		<meta charset="UTF-8" />
		<meta
			http-equiv="Content-Security-Policy"
			content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com; style-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com"
		/>
		<script src="https://cdn.tailwindcss.com"></script>
	</head>
	<body class="bg-gray-100">
		<div class="container mx-auto px-4 py-8 max-w-4xl">
			<h2 class="text-3xl font-bold text-gray-800 mb-8">Şifre Yöneticisi</h2>

			<div id="backupSection" class="bg-white rounded-lg shadow-md p-6 mb-8">
				<h3 class="text-xl font-semibold text-gray-800 mb-4">Yedekleme</h3>
				<div class="space-x-4">
					<button
						onclick="backupPasswords('daily')"
						class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-md transition duration-200"
					>
						Günlük Yedek
					</button>
					<button
						onclick="backupPasswords('weekly')"
						class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-md transition duration-200"
					>
						Haftalık Yedek
					</button>
					<button
						onclick="backupPasswords('monthly')"
						class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-md transition duration-200"
					>
						Aylık Yedek
					</button>
				</div>
			</div>

			<form id="addPasswordForm" class="bg-white rounded-lg shadow-md p-6 mb-8" onsubmit="return false;">
				<h3 class="text-xl font-semibold text-gray-800 mb-4">Yeni Şifre Ekle</h3>
				<div class="grid gap-4">
					<div>
						<label for="title" class="block text-gray-700 text-sm font-bold mb-2">Başlık:</label>
						<input
							type="text"
							id="title"
							name="title"
							class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
						/>
					</div>
					<div>
						<label for="username" class="block text-gray-700 text-sm font-bold mb-2">Kullanıcı Adı:</label>
						<input
							type="text"
							id="username"
							name="username"
							class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
						/>
					</div>
					<div>
						<label for="email" class="block text-gray-700 text-sm font-bold mb-2">E-posta:</label>
						<input
							type="email"
							id="email"
							name="email"
							class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
						/>
					</div>
					<div>
						<label for="password" class="block text-gray-700 text-sm font-bold mb-2">Şifre:</label>
						<input
							type="password"
							id="password"
							name="password"
							class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
						/>
					</div>
					<button
						type="submit"
						id="saveButton"
						class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-md transition duration-200"
					>
						Kaydet
					</button>
				</div>
			</form>

			<div id="passwordList" class="space-y-4"></div>
		</div>

		<script>
			const { ipcRenderer } = require('electron')

			// Form ve input elementlerini seç
			const form = document.getElementById('addPasswordForm')
			const titleInput = document.getElementById('title')
			const usernameInput = document.getElementById('username')
			const emailInput = document.getElementById('email')
			const passwordInput = document.getElementById('password')
			const saveButton = document.getElementById('saveButton')

			// Input olaylarını dinle
			const inputs = [titleInput, usernameInput, emailInput, passwordInput]
			inputs.forEach((input) => {
				input.addEventListener('click', () => {
					input.removeAttribute('readonly')
					input.removeAttribute('disabled')
				})

				input.addEventListener('focus', () => {
					input.removeAttribute('readonly')
					input.removeAttribute('disabled')
				})
			})

			// Form submit olayını dinle
			saveButton.addEventListener('click', async (e) => {
				e.preventDefault()
				console.log('Kaydet butonuna tıklandı')
				await savePassword()
			})

			form.addEventListener('submit', async (e) => {
				e.preventDefault()
				console.log('Form submit edildi')
				await savePassword()
			})

			// Sayfa yüklendiğinde çalışacak kodlar
			document.addEventListener('DOMContentLoaded', () => {
				console.log('Sayfa yüklendi')

				// Input alanlarını etkinleştir
				inputs.forEach((input) => {
					input.removeAttribute('readonly')
					input.removeAttribute('disabled')
				})

				// Şifreleri yükle
				loadPasswords()
			})

			async function savePassword() {
				console.log('savePassword fonksiyonu çağrıldı')

				const title = titleInput.value.trim()
				const username = usernameInput.value.trim()
				const email = emailInput.value.trim()
				const password = passwordInput.value.trim()

				console.log('Form değerleri:', { title, username, email, password: '***' })

				if (!title || !password) {
					alert('Lütfen başlık ve şifre alanlarını doldurun!')
					return
				}

				try {
					await ipcRenderer.invoke('savePassword', {
						title,
						username,
						email,
						password
					})
					alert('Şifre başarıyla kaydedildi!')
					loadPasswords()
					clearForm()
				} catch (error) {
					console.error('Kaydetme hatası:', error)
					alert('Hata: ' + error.message)
				}
			}

			async function loadPasswords() {
				try {
					const passwords = await ipcRenderer.invoke('getPasswords')
					const passwordList = document.getElementById('passwordList')
					passwordList.innerHTML = passwords
						.map(
							(item) => `
								<div class="bg-white rounded-lg shadow-md p-6">
									<div class="flex justify-between items-start mb-4">
										<h4 class="text-lg font-semibold text-gray-800">${item.title}</h4>
										<div class="space-x-2">
											<button onclick="editPassword(${item.id}, '${item.title}', '${item.username || ''}', '${item.email || ''}', '${
								item.password
							}')" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-1 px-3 rounded-md transition duration-200">
												Düzenle
											</button>
											<button onclick="deletePassword(${
												item.id
											})" class="bg-red-500 hover:bg-red-600 text-white font-bold py-1 px-3 rounded-md transition duration-200">
												Sil
											</button>
										</div>
									</div>
									${item.username ? `<p class="text-gray-600 mb-2">Kullanıcı Adı: ${item.username}</p>` : ''}
									${item.email ? `<p class="text-gray-600 mb-2">E-posta: ${item.email}</p>` : ''}
									<p class="text-gray-600">Şifre: <span class="font-mono">••••••••</span></p>
								</div>
							`
						)
						.join('')
				} catch (error) {
					alert('Hata: ' + error.message)
				}
			}

			function clearForm() {
				form.reset()
			}

			async function deletePassword(id) {
				if (!confirm('Bu şifreyi silmek istediğinizden emin misiniz?')) {
					return
				}

				try {
					await ipcRenderer.invoke('deletePassword', { id })
					alert('Şifre başarıyla silindi!')
					loadPasswords()
				} catch (error) {
					alert('Hata: ' + error.message)
				}
			}

			async function editPassword(id, title, username, email, password) {
				titleInput.value = title
				usernameInput.value = username
				emailInput.value = email
				passwordInput.value = password

				// Kaydet butonunu güncelle
				saveButton.textContent = 'Güncelle'
				saveButton.onclick = async () => {
					const newTitle = titleInput.value.trim()
					const newUsername = usernameInput.value.trim()
					const newEmail = emailInput.value.trim()
					const newPassword = passwordInput.value.trim()

					try {
						await ipcRenderer.invoke('updatePassword', {
							id,
							title: newTitle,
							username: newUsername,
							email: newEmail,
							password: newPassword
						})
						alert('Şifre başarıyla güncellendi!')
						loadPasswords()
						clearForm()
						// Kaydet butonunu eski haline getir
						saveButton.textContent = 'Kaydet'
						saveButton.onclick = savePassword
					} catch (error) {
						alert('Hata: ' + error.message)
					}
				}
			}

			async function backupPasswords(backupType) {
				try {
					await ipcRenderer.invoke('backupPasswords', {
						backupType
					})
					alert('Yedekleme başarıyla tamamlandı!')
				} catch (error) {
					alert('Hata: ' + error.message)
				}
			}
		</script>
	</body>
</html>
