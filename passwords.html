<!DOCTYPE html>
<html>
	<head>
		<title>Şifre Yöneticisi</title>
		<meta charset="UTF-8" />
		<style>
			body {
				font-family: Arial, sans-serif;
				padding: 20px;
			}
			.container {
				max-width: 800px;
				margin: 0 auto;
			}
			.form-group {
				margin-bottom: 15px;
			}
			.form-group label {
				display: block;
				margin-bottom: 5px;
			}
			.form-group input {
				width: 100%;
				padding: 8px;
			}
			button {
				padding: 10px 20px;
				background-color: #4caf50;
				color: white;
				border: none;
				cursor: pointer;
				margin-right: 10px;
			}
			.password-list {
				margin-top: 30px;
			}
			.password-item {
				border: 1px solid #ddd;
				padding: 10px;
				margin-bottom: 10px;
				border-radius: 4px;
			}
			.password-value {
				-webkit-text-security: disc;
			}
			.password-actions {
				float: right;
			}
			.edit-btn {
				background-color: #2196f3;
				margin-right: 5px;
			}
			.delete-btn {
				background-color: #f44336;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<h2>Şifre Yöneticisi</h2>

			<div id="backupSection" style="margin-bottom: 30px">
				<h3>Yedekleme</h3>
				<button onclick="backupPasswords('daily')">Günlük Yedek</button>
				<button onclick="backupPasswords('weekly')">Haftalık Yedek</button>
				<button onclick="backupPasswords('monthly')">Aylık Yedek</button>
			</div>

			<div id="addPasswordForm">
				<h3>Yeni Şifre Ekle</h3>
				<div class="form-group">
					<label>Başlık:</label>
					<input type="text" id="title" />
				</div>
				<div class="form-group">
					<label>Kullanıcı Adı:</label>
					<input type="text" id="username" />
				</div>
				<div class="form-group">
					<label>E-posta:</label>
					<input type="email" id="email" />
				</div>
				<div class="form-group">
					<label>Şifre:</label>
					<input type="password" id="password" />
				</div>
				<div class="form-group">
					<label>Ana Şifre:</label>
					<input type="password" id="masterPassword" />
				</div>
				<button onclick="savePassword()">Kaydet</button>
			</div>

			<div class="password-list" id="passwordList"></div>
		</div>

		<script>
			const { ipcRenderer } = require('electron')

			async function savePassword() {
				const title = document.getElementById('title').value
				const username = document.getElementById('username').value
				const email = document.getElementById('email').value
				const password = document.getElementById('password').value
				const masterPassword = document.getElementById('masterPassword').value

				if (!title || !password || !masterPassword) {
					alert('Lütfen gerekli alanları doldurun!')
					return
				}

				try {
					await ipcRenderer.invoke('savePassword', {
						title,
						username,
						email,
						password,
						masterPassword
					})
					alert('Şifre başarıyla kaydedildi!')
					loadPasswords()
					clearForm()
				} catch (error) {
					alert('Hata: ' + error.message)
				}
			}

			async function loadPasswords() {
				const masterPassword = document.getElementById('masterPassword').value
				if (!masterPassword) {
					alert('Ana şifre gerekli!')
					return
				}

				try {
					const passwords = await ipcRenderer.invoke('getPasswords', masterPassword)
					const passwordList = document.getElementById('passwordList')
					passwordList.innerHTML = passwords
						.map(
							(item) => `
								<div class="password-item">
									<div class="password-actions">
										<button onclick="editPassword(${item.id}, '${item.title}', '${item.username || ''}', '${item.email || ''}', '${
								item.password
							}')" class="edit-btn">Düzenle</button>
										<button onclick="deletePassword(${item.id})" class="delete-btn">Sil</button>
									</div>
									<h4>${item.title}</h4>
									${item.username ? `<p>Kullanıcı Adı: ${item.username}</p>` : ''}
									${item.email ? `<p>E-posta: ${item.email}</p>` : ''}
									<p>Şifre: <span class="password-value">${item.password}</span></p>
								</div>
							`
						)
						.join('')
				} catch (error) {
					alert('Hata: ' + error.message)
				}
			}

			function clearForm() {
				document.getElementById('title').value = ''
				document.getElementById('username').value = ''
				document.getElementById('email').value = ''
				document.getElementById('password').value = ''
			}

			async function backupPasswords(backupType) {
				const masterPassword = document.getElementById('masterPassword').value
				if (!masterPassword) {
					alert('Ana şifre gerekli!')
					return
				}

				try {
					await ipcRenderer.invoke('backupPasswords', {
						masterPassword,
						backupType
					})
					alert('Yedekleme başarıyla tamamlandı!')
				} catch (error) {
					alert('Hata: ' + error.message)
				}
			}

			async function deletePassword(id) {
				if (!confirm('Bu şifreyi silmek istediğinizden emin misiniz?')) {
					return
				}

				const masterPassword = document.getElementById('masterPassword').value
				try {
					await ipcRenderer.invoke('deletePassword', { id, masterPassword })
					alert('Şifre başarıyla silindi!')
					loadPasswords()
				} catch (error) {
					alert('Hata: ' + error.message)
				}
			}

			async function editPassword(id, title, username, email, password) {
				document.getElementById('title').value = title
				document.getElementById('username').value = username
				document.getElementById('email').value = email
				document.getElementById('password').value = password

				// Kaydet butonunu güncelle
				const saveButton = document.querySelector('#addPasswordForm button')
				saveButton.textContent = 'Güncelle'
				saveButton.onclick = async () => {
					const masterPassword = document.getElementById('masterPassword').value
					const newTitle = document.getElementById('title').value
					const newUsername = document.getElementById('username').value
					const newEmail = document.getElementById('email').value
					const newPassword = document.getElementById('password').value

					try {
						await ipcRenderer.invoke('updatePassword', {
							id,
							title: newTitle,
							username: newUsername,
							email: newEmail,
							password: newPassword,
							masterPassword
						})
						alert('Şifre başarıyla güncellendi!')
						loadPasswords()
						clearForm()
						// Kaydet butonunu eski haline getir
						saveButton.textContent = 'Kaydet'
						saveButton.onclick = savePassword
					} catch (error) {
						alert('Hata: ' + error.message)
					}
				}
			}

			document.addEventListener('DOMContentLoaded', () => {
				const masterPassword = document.getElementById('masterPassword')
				masterPassword.addEventListener('input', () => {
					if (masterPassword.value) {
						loadPasswords()
					}
				})
			})
		</script>
	</body>
</html>
