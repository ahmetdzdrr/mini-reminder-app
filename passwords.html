<!DOCTYPE html>
<html>
	<head>
		<title>Şifre Yöneticisi</title>
		<meta charset="UTF-8" />
		<script src="https://cdn.tailwindcss.com"></script>
	</head>
	<body class="bg-gray-100">
		<div class="container mx-auto px-4 py-8 max-w-4xl">
			<h2 class="text-3xl font-bold text-gray-800 mb-8">Şifre Yöneticisi</h2>

			<div id="backupSection" class="bg-white rounded-lg shadow-md p-6 mb-8">
				<h3 class="text-xl font-semibold text-gray-800 mb-4">Yedekleme</h3>
				<div class="space-x-4">
					<button
						onclick="backupPasswords('daily')"
						class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-md transition duration-200"
					>
						Günlük Yedek
					</button>
					<button
						onclick="backupPasswords('weekly')"
						class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-md transition duration-200"
					>
						Haftalık Yedek
					</button>
					<button
						onclick="backupPasswords('monthly')"
						class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-md transition duration-200"
					>
						Aylık Yedek
					</button>
				</div>
			</div>

			<div id="addPasswordForm" class="bg-white rounded-lg shadow-md p-6 mb-8">
				<h3 class="text-xl font-semibold text-gray-800 mb-4">Yeni Şifre Ekle</h3>
				<div class="grid gap-4">
					<div>
						<label class="block text-gray-700 text-sm font-bold mb-2">Başlık:</label>
						<input
							type="text"
							id="title"
							class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
						/>
					</div>
					<div>
						<label class="block text-gray-700 text-sm font-bold mb-2">Kullanıcı Adı:</label>
						<input
							type="text"
							id="username"
							class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
						/>
					</div>
					<div>
						<label class="block text-gray-700 text-sm font-bold mb-2">E-posta:</label>
						<input
							type="email"
							id="email"
							class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
						/>
					</div>
					<div>
						<label class="block text-gray-700 text-sm font-bold mb-2">Şifre:</label>
						<input
							type="password"
							id="password"
							class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
						/>
					</div>
					<div>
						<label class="block text-gray-700 text-sm font-bold mb-2">Ana Şifre:</label>
						<input
							type="password"
							id="masterPassword"
							class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
						/>
					</div>
					<button
						onclick="savePassword()"
						class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-md transition duration-200"
					>
						Kaydet
					</button>
				</div>
			</div>

			<div id="passwordList" class="space-y-4"></div>
		</div>

		<script>
			const { ipcRenderer } = require('electron')

			async function savePassword() {
				const title = document.getElementById('title').value
				const username = document.getElementById('username').value
				const email = document.getElementById('email').value
				const password = document.getElementById('password').value
				const masterPassword = document.getElementById('masterPassword').value

				if (!title || !password || !masterPassword) {
					alert('Lütfen gerekli alanları doldurun!')
					return
				}

				try {
					await ipcRenderer.invoke('savePassword', {
						title,
						username,
						email,
						password,
						masterPassword
					})
					alert('Şifre başarıyla kaydedildi!')
					loadPasswords()
					clearForm()
				} catch (error) {
					alert('Hata: ' + error.message)
				}
			}

			async function loadPasswords() {
				const masterPassword = document.getElementById('masterPassword').value
				if (!masterPassword) {
					alert('Ana şifre gerekli!')
					return
				}

				try {
					const passwords = await ipcRenderer.invoke('getPasswords', masterPassword)
					const passwordList = document.getElementById('passwordList')
					passwordList.innerHTML = passwords
						.map(
							(item) => `
								<div class="bg-white rounded-lg shadow-md p-6">
									<div class="flex justify-between items-start mb-4">
										<h4 class="text-lg font-semibold text-gray-800">${item.title}</h4>
										<div class="space-x-2">
											<button onclick="editPassword(${item.id}, '${item.title}', '${item.username || ''}', '${item.email || ''}', '${
								item.password
							}')" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-1 px-3 rounded-md transition duration-200">
												Düzenle
											</button>
											<button onclick="deletePassword(${
												item.id
											})" class="bg-red-500 hover:bg-red-600 text-white font-bold py-1 px-3 rounded-md transition duration-200">
												Sil
											</button>
										</div>
									</div>
									${item.username ? `<p class="text-gray-600 mb-2">Kullanıcı Adı: ${item.username}</p>` : ''}
									${item.email ? `<p class="text-gray-600 mb-2">E-posta: ${item.email}</p>` : ''}
									<p class="text-gray-600">Şifre: <span class="font-mono">••••••••</span></p>
								</div>
							`
						)
						.join('')
				} catch (error) {
					alert('Hata: ' + error.message)
				}
			}

			function clearForm() {
				document.getElementById('title').value = ''
				document.getElementById('username').value = ''
				document.getElementById('email').value = ''
				document.getElementById('password').value = ''
			}

			async function backupPasswords(backupType) {
				const masterPassword = document.getElementById('masterPassword').value
				if (!masterPassword) {
					alert('Ana şifre gerekli!')
					return
				}

				try {
					await ipcRenderer.invoke('backupPasswords', {
						masterPassword,
						backupType
					})
					alert('Yedekleme başarıyla tamamlandı!')
				} catch (error) {
					alert('Hata: ' + error.message)
				}
			}

			async function deletePassword(id) {
				if (!confirm('Bu şifreyi silmek istediğinizden emin misiniz?')) {
					return
				}

				const masterPassword = document.getElementById('masterPassword').value
				try {
					await ipcRenderer.invoke('deletePassword', { id, masterPassword })
					alert('Şifre başarıyla silindi!')
					loadPasswords()
				} catch (error) {
					alert('Hata: ' + error.message)
				}
			}

			async function editPassword(id, title, username, email, password) {
				document.getElementById('title').value = title
				document.getElementById('username').value = username
				document.getElementById('email').value = email
				document.getElementById('password').value = password

				// Kaydet butonunu güncelle
				const saveButton = document.querySelector('#addPasswordForm button')
				saveButton.textContent = 'Güncelle'
				saveButton.onclick = async () => {
					const masterPassword = document.getElementById('masterPassword').value
					const newTitle = document.getElementById('title').value
					const newUsername = document.getElementById('username').value
					const newEmail = document.getElementById('email').value
					const newPassword = document.getElementById('password').value

					try {
						await ipcRenderer.invoke('updatePassword', {
							id,
							title: newTitle,
							username: newUsername,
							email: newEmail,
							password: newPassword,
							masterPassword
						})
						alert('Şifre başarıyla güncellendi!')
						loadPasswords()
						clearForm()
						// Kaydet butonunu eski haline getir
						saveButton.textContent = 'Kaydet'
						saveButton.onclick = savePassword
					} catch (error) {
						alert('Hata: ' + error.message)
					}
				}
			}

			document.addEventListener('DOMContentLoaded', () => {
				const masterPassword = document.getElementById('masterPassword')
				masterPassword.addEventListener('input', () => {
					if (masterPassword.value) {
						loadPasswords()
					}
				})
			})
		</script>
	</body>
</html>
